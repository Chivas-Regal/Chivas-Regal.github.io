---
layout: post
title: è«é˜Ÿç®—æ³•
subtitle: ç¦»çº¿æ“ä½œå•Šï¼Œå…ˆä¿å­˜åè¾“å‡ºï¼ŸğŸ¤”
categories: æ•°æ®ç»“æ„
tags: [æ•°æ®ç»“æ„]
---

<head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
	<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
	</style>
        <style>
		.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
	</style>
</head>
<body class="vscode-body vscode-light">
        <h2 id="æ™®é€šè«é˜Ÿ">æ™®é€šè«é˜Ÿ</h2>
<h3 id="é—®é¢˜ç±»å‹">é—®é¢˜ç±»å‹</h3>
<blockquote>
<p>ç»™å®š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">m</span></span></span></span>ä¸ªæŸ¥è¯¢æ“ä½œï¼Œæ²¡æœ‰ä¿®æ”¹æ“ä½œï¼Œæ¯æ¬¡æŸ¥è¯¢<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span>æœ‰å¤šå°‘ä¸ªä¸åŒçš„æ•°</p>
</blockquote>
<h3 id="ä½œç”¨">ä½œç”¨</h3>
<p>å¯ä»¥è§£å†³<span style="color: red;">åŒºé—´ç¦»çº¿é—®é¢˜</span>çš„ç¦»çº¿ç®—æ³•ï¼Œå¦‚æœåœ¨çº¿å¯èƒ½ä¼šTæ‰<br>
æ—¶é—´ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> ï¼Œä½†å¯èƒ½ä¼šæœ‰å‡ºé¢˜äººå¡è«é˜Ÿ</p>
<h3 id="ä¼˜åŒ–ç­–ç•¥">ä¼˜åŒ–ç­–ç•¥</h3>
<h4 id="åŒæŒ‡é’ˆ">åŒæŒ‡é’ˆ</h4>
<blockquote>
<p>ç»™ä¸ªæ•°åˆ—æœ‰è‹¥å¹²æ¬¡è¯¢é—® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>L</mi><mo separator="true">,</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[L,R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">L</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span> çš„åŒºé—´å’Œï¼ˆå¼ºåˆ¶è«é˜Ÿï¼‰</p>
<p>è§£ï¼šå¼€ä¸ªæ•°ç»„</p>
<table>
<thead>
<tr>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">4</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">5</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">6</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">7</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span></th>
<th><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>9</mn></mrow><annotation encoding="application/x-tex">9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">9</span></span></span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">7</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">4</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>9</mn></mrow><annotation encoding="application/x-tex">9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">9</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">6</span></span></span></span></td>
</tr>
</tbody>
</table>
<p>è‹¥ç°åœ¨çŸ¥é“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>2</mn><mo separator="true">,</mo><mn>5</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[2,5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">2</span><span class="mpunct">,</span><span class="mord mathrm">5</span><span class="mclose">]</span></span></span></span> åŒºé—´å’Œä¸º18<br>
Â Â Â æ±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>2</mn><mo separator="true">,</mo><mn>6</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[2,6]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">2</span><span class="mpunct">,</span><span class="mord mathrm">6</span><span class="mclose">]</span></span></span></span> çš„åŒºé—´å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‡’</mo></mrow><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.36687em;"></span><span class="strut bottom" style="height:0.36687em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mrel">â‡’</span></span></span></span> åŠ ä¸Šç¬¬6é¡¹çš„å€¼<br>
Â Â Â æ±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>2</mn><mo separator="true">,</mo><mn>4</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[2,4]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">2</span><span class="mpunct">,</span><span class="mord mathrm">4</span><span class="mclose">]</span></span></span></span> çš„åŒºé—´å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‡’</mo></mrow><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.36687em;"></span><span class="strut bottom" style="height:0.36687em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mrel">â‡’</span></span></span></span> åˆ æ‰ç¬¬5é¡¹çš„å€¼</p>
</blockquote>
<p>æœ´ç´ æ¥çœ‹ï¼Œå¯¹äºåŒºé—´ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>L</mi><mo separator="true">,</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[L, R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">L</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span> :<ol>
<li>åŠ ä¸Šå·¦è¾¹ä¸€æ ¼è´¡çŒ®: add(--l)</li>
<li>åŠ ä¸Šå³è¾¹ä¸€æ ¼è´¡çŒ®: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi><mo>(</mo><mo>+</mo><mo>+</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">add(++r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">d</span><span class="mopen">(</span><span class="mord">+</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></li>
<li>å‡å»å·¦è¾¹ä¸€æ ¼è´¡çŒ®: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>u</mi><mi>b</mi><mo>(</mo><mo>+</mo><mo>+</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">sub(++l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span><span class="mord mathit">u</span><span class="mord mathit">b</span><span class="mopen">(</span><span class="mord">+</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span></li>
<li>å‡å»å³è¾¹ä¸€æ ¼è´¡çŒ®: sub(--r)</li></p>
</ol>
<h4 id="æ’åºåˆ†å—">æ’åºåˆ†å—</h4>
<blockquote>
<p>è‹¥è¯¢é—® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">m</span></span></span></span> æ¬¡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">[1,2],\;[n-1,n],\;[1,2],\;[n-1,n],\;[1,2].....</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span></span> ï¼Œä¸Šé¢çš„æ–¹æ³•å°±å˜æˆäº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>m</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(mn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">m</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></p>
<p>å¯ä»¥æ”¹æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>]</mo><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mo>[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>]</mo><mspace width="0.277778em"></mspace><mo>[</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">[1,2],\;[1,2],\;[1,2],\;[n-1,n],\;[n-1,n]\;[n-1,n]...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">]</span><span class="mord mspace thickspace"></span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">n</span><span class="mclose">]</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span></span></p>
</blockquote>
<p>è¿™æ ·å°†è·ç¦»è¾ƒè¿‘çš„åŒºé—´æ”¾åœ¨ä¸€èµ·ï¼Œæ—¶é—´å¤æ‚åº¦å˜æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>+</mo><mi>m</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n+m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mbin">+</span><span class="mord mathit">m</span><span class="mclose">)</span></span></span></span></p>
<h3 id="ç®—æ³•æ¶æ„">ç®—æ³•æ¶æ„</h3>
<p>|--åˆ†å—<br>
|--è®°å½•è¯¢é—®<br>
|--æ’åº<br>
|--éå†è¯¢é—®<br>
|----è‹¥å·¦è¾¹çŸ­ï¼Œå·¦æŒ‡é’ˆå‘å·¦åŠ ä¸€ä¸ªæ•°<br>
|----è‹¥å³è¾¹çŸ­ï¼Œå³æŒ‡é’ˆå‘å³åŠ ä¸€ä¸ªæ•°<br>
|----è‹¥å·¦è¾¹é•¿ï¼Œå·¦æŒ‡é’ˆå‘å³å‡ä¸€ä¸ªæ•°<br>
|----è‹¥å³è¾¹é•¿ï¼Œå³æŒ‡é’ˆå‘å·¦å‡ä¸€ä¸ªæ•°<br>
|----è®°å½•ç­”æ¡ˆå­˜å…¥æ–°æ•°ç»„<br>
|--ä»¥æ–°æ•°ç»„é¡ºåºè¾“å‡º</p>
<blockquote>
<p><a href="https://vjudge.net/problem/%E9%BB%91%E6%9A%97%E7%88%86%E7%82%B8-1878">é»‘æš—çˆ†ç‚¸-1878ã€ŠHHçš„é¡¹é“¾ã€‹</a></p>
</blockquote>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e4</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">int</span> pos[N];
<span class="hljs-keyword">int</span> a[N];
<span class="hljs-keyword">int</span> res[N];
<span class="hljs-keyword">int</span> RES;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Q</span>{</span>
        <span class="hljs-keyword">int</span> l, r, id;
}q[N];
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ONLINE_JUDGE</span>
        freopen(<span class="hljs-string">&quot;in.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-built_in">stdin</span>);
        freopen(<span class="hljs-string">&quot;out.out&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-built_in">stdout</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
        <span class="hljs-comment">// n m l r</span>
        <span class="hljs-keyword">int</span> n, m, l, r;
        <span class="hljs-built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; l &gt;&gt; r;
        <span class="hljs-comment">// åˆ†å—</span>
        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">sqrt</span>(n);
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ )
                <span class="hljs-built_in">cin</span> &gt;&gt; a[i],
                pos[i] = i / len;
        <span class="hljs-comment">// è¯¢é—®</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ )
                <span class="hljs-built_in">cin</span> &gt;&gt; q[i].l &gt;&gt; q[i].r,
                q[i].id = i;
        <span class="hljs-comment">// æ’åº</span>
        sort (q, q + m, [](Q x, Q y){
                <span class="hljs-keyword">return</span> pos[x.l] == pos[y.l] ? x.r &lt; y.r : pos[x.l] &lt; pos[y.l];
        });
        <span class="hljs-comment">// åˆå§‹åŒ–ä¸ºå¼€åŒºé—´</span>
        <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>, r = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {
                <span class="hljs-comment">// å·¦è¾¹å¤ªçŸ­äº†ï¼Œlå‘å·¦åŠ ä¸€æ ¼</span>
                <span class="hljs-keyword">while</span> ( q[i].l &lt; l ) Add ( -- l );
                <span class="hljs-comment">// å³è¾¹å¤ªçŸ­äº†ï¼Œrå‘å³åŠ ä¸€æ ¼</span>
                <span class="hljs-keyword">while</span> ( q[i].r &gt; r ) Add ( ++ r );
                <span class="hljs-comment">// å·¦è¾¹å¤ªé•¿äº†ï¼Œlå‘å³å‡ä¸€æ ¼</span>
                <span class="hljs-keyword">while</span> ( q[i].l &gt; l ) Sub ( ++ l );
                <span class="hljs-comment">// å³è¾¹å¤ªé•¿äº†ï¼Œrå‘å·¦å‡ä¸€æ ¼</span>
                <span class="hljs-keyword">while</span> ( q[i].r &lt; r ) Sub ( -- r );
                <span class="hljs-comment">// è®°å½•ç­”æ¡ˆ</span>
                res[q[i].id] = RES;
        }
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ )
                <span class="hljs-built_in">cout</span> &lt;&lt; res[i] &lt;&lt; <span class="hljs-built_in">endl</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</div></code></pre>
<h2 id="å¸¦ä¿®è«é˜Ÿ">å¸¦ä¿®è«é˜Ÿ</h2>
<h3 id="é—®é¢˜ç±»å‹-1">é—®é¢˜ç±»å‹</h3>
<blockquote>
<p>å¤šäº†ä¸ªä¿®æ”¹çš„ç‰ˆæœ¬é—®é¢˜ï¼Œç±»ä¼¼äºæ—¶é—´</p>
</blockquote>
<p>é‚£ä¹ˆå¯ä»¥<span style="color: red;">åŠ ä¸€ç»´è®°å½•æ—¶é—´æˆ³</span><br>
æ¯æ¬¡æŸ¥è¯¢å¯ä»¥ç¡®å®šä¸€ä¸‹ç‰ˆæœ¬ï¼Œå³ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> æ¬¡ä¿®æ”¹ä¹‹åï¼Œç¬¬k+1æ¬¡ä¿®æ”¹ä¹‹å‰</p>
<h3 id="æŒ‡é’ˆç§»åŠ¨">æŒ‡é’ˆç§»åŠ¨</h3>
<p>åœ¨åŒç‰ˆæœ¬ä¸‹çš„ç§»åŠ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l, r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> å¯ä»¥æ˜¯æ™®é€šè«é˜Ÿ<br>
åœ¨<span style="color: red;">è·³ç‰ˆæœ¬</span>ä¸‹ç§»åŠ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo separator="true">,</mo><mi>t</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l, r, t]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">]</span></span></span></span> è¦<span style="color: red;">è€ƒè™‘ä¸¤ç§æƒ…å†µ</span><br>
1.ä¿®æ”¹çš„æ•°åœ¨åŒºé—´å¤–ï¼Œä¸ç”¨ç†ä¼š<br>
2.ä¿®æ”¹çš„æ•°åœ¨åŒºé—´å†…ï¼Œè®¡æ•°å‡ä¸€ä¸‹ä¿®æ”¹å‰çš„æ•°ï¼Œå†åŠ ä¸€ä¸‹ä¿®æ”¹åçš„æ•°</p>
<h3 id="ä¿®æ”¹æ“ä½œ">ä¿®æ”¹æ“ä½œ</h3>
<p>å¯ä»¥æŠŠä¿®æ”¹æ“ä½œè®°å½•ä¸€ä¸ªæ•°ç»„ï¼Œæ¯æ¬¡ä¿®æ”¹çš„æ•°ç»„å†…å­˜æ”¾è¿™æ¬¡ä¿®æ”¹çš„æ˜¯ä»€ä¹ˆæ•°<br>
é‚£ä¹ˆåœ¨æŒ‡é’ˆç§»åŠ¨çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦å°†åŸä½ç½®çš„æ•°å’Œä¿®æ”¹åçš„æ•°<span style="color:red;">äº¤æ¢ä¸€ä¸‹</span></p>
<h3 id="æ’åºä¼˜å…ˆçº§">æ’åºä¼˜å…ˆçº§</h3>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> æ‰€åœ¨å—ç¼–å·ï¼Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span> æ‰€åœ¨å—ç¼–å·ï¼Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span></span></span></span> é¡ºç€é€’å¢
å—é•¿ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mroot><mrow><mi>n</mi><mi>t</mi></mrow><mrow><mn>3</mn></mrow></mroot><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\sqrt[3]{nt})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8925400000000001em;"></span><span class="strut bottom" style="height:1.1425400000000001em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="sqrt mord"><span class="root"><span class="vlist"><span style="top:-0.4470480000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mord mathrm">3</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="sqrt-sign" style="top:-0.05254000000000003em;"><span class="style-wrap reset-textstyle textstyle uncramped">âˆš</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="mord textstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">t</span></span></span><span style="top:-0.81254em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span></span></span></span></p>
<h3 id="æ€æƒ³æ€»ç»“">æ€æƒ³æ€»ç»“</h3>
<p>å¸¦ä¿®è«é˜Ÿå¤šäº†ä¸ª<span style="color:red;">æ—¶é—´æˆ³</span>çš„ç§»åŠ¨<br>
ä¹Ÿå¯ä»¥è¢«è§†ä½œç¬¬ä¸‰ä¸ªæŒ‡é’ˆ<br>
å…¶ä¸­å¯ä»¥åšä¹Ÿæ˜¯å¿…åšçš„ä¼˜åŒ–å°±æ˜¯æˆ‘ä»¬å†ä¿®æ”¹çš„çš„æ—¶å€™è®°å½•æ“ä½œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹ï¼Œå› ä¸ºæ—¶é—´æˆ³æŒ‡é’ˆå¯èƒ½ä¼šæ¥å›æŠ˜è¿”ï¼Œæˆ‘ä»¬è¦çŸ¥é“ä¸‹ä¸€æ­¥è¦æ”¹æˆä»€ä¹ˆ<br>
åœ¨ç§»åŠ¨æ—¶é—´æˆ³æ—¶ï¼Œèµ°è¿‡æŸä¸ªä¿®æ”¹æ—¶åªéœ€è¦å°†ä¿®æ”¹çš„å€¼å’ŒåŸå§‹å€¼è°ƒæ¢ä¸€ä¸‹<br>
å¦‚æœåœ¨åŒºé—´å¤–ä¹Ÿè¦äº¤æ¢ï¼Œå› ä¸ºä¹‹åéå† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>L</mi><mo separator="true">,</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[L,R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">L</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span> ä¹Ÿä¼šèµ°è¿‡å»</p>
<h3 id="ç®—æ³•æ¶æ„-1">ç®—æ³•æ¶æ„</h3>
<p>|--è®°å½•æŸ¥è¯¢<br>
|--è®°å½•ä¿®æ”¹<br>
|--å¯¹æŸ¥è¯¢æ’åº<br>
|--ä¸‰ä¸ªæŒ‡é’ˆ
|----å·¦å³æŒ‡é’ˆåœ¨ä¸€ä¸ªç‰ˆæœ¬å†…è·‘æ¥å›ºå®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>q</mi><mi mathvariant="normal">.</mi><mi>l</mi><mo separator="true">,</mo><mi>q</mi><mi mathvariant="normal">.</mi><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[q.l,q.r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mord mathrm">.</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mord mathrm">.</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> åŒºé—´
|----ç‰ˆæœ¬æŒ‡é’ˆåœ¨å¤šä¸ªç‰ˆæœ¬ä¸Šè·³
|------äº¤æ¢ä¿®æ”¹çš„æ•°å’ŒåŸæ•°
|------åˆ¤æ–­è¿™ä¸ªç‰ˆæœ¬ä¿®æ”¹æ˜¯å¦åœ¨å·¦å³æŒ‡é’ˆé‚£ï¼Œçœ‹çœ‹éœ€ä¸éœ€è¦ä¿®æ”¹å½“å‰RES
|--å½•å…¥ç­”æ¡ˆ
|--è¾“å‡º</p>
<blockquote>
<p><a href="https://www.luogu.com.cn/problem/P1903">æ´›è°·-P1903ã€Š[å›½å®¶é›†è®­é˜Ÿ]æ•°é¢œè‰² / ç»´æŠ¤é˜Ÿåˆ—ã€‹</a></p>
</blockquote>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e4</span> + <span class="hljs-number">10</span>, M = <span class="hljs-number">1e6</span> + <span class="hljs-number">10</span>;

<span class="hljs-keyword">int</span> cnt[M], a[N], res[N], pos[N];
<span class="hljs-keyword">int</span> n, m, len;
<span class="hljs-keyword">int</span> nq, nm, RES;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Q</span>{</span>
	<span class="hljs-keyword">int</span> l, r, t, id;
}qry[N];
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">M</span>{</span>
	<span class="hljs-keyword">int</span> x, y;
}mdf[N];

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{
	RES += ! cnt[x] ++;
}
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sub</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{
	RES -= ! -- cnt[x];
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);
	<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ )
		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;a[i]);
	<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i ++ ) {
		<span class="hljs-keyword">char</span> op[<span class="hljs-number">2</span>]; <span class="hljs-keyword">int</span> x, y;
		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s%d%d&quot;</span>, op, &amp;x, &amp;y);
		<span class="hljs-keyword">if</span> ( op[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;Q&#x27;</span> ) ++ nq, qry[nq] = { x, y, nm, nq };
		<span class="hljs-keyword">else</span>                ++ nm, mdf[nm] = { x, y };
	} 
	len = cbrt ((<span class="hljs-keyword">double</span>)n * nm) + <span class="hljs-number">1</span>;
	<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i ++ ) 
		pos[i] = i / len;
	sort ( qry + <span class="hljs-number">1</span>, qry + <span class="hljs-number">1</span> + nm, [&amp;]( Q a, Q b ){
		<span class="hljs-keyword">if</span> ( pos[a.l] != pos[b.l] ) <span class="hljs-keyword">return</span> pos[a.l] &lt; pos[b.l];
		<span class="hljs-keyword">if</span> ( pos[a.r] != pos[b.r] ) <span class="hljs-keyword">return</span> pos[a.r] &lt; pos[b.r];
		<span class="hljs-keyword">if</span> ( pos[a.r] &amp; <span class="hljs-number">1</span> ) <span class="hljs-keyword">return</span> a.t &gt; b.t;
		<span class="hljs-keyword">return</span> a.t &lt; b.t;		
	});
	
	<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> L = <span class="hljs-number">1</span>, R = <span class="hljs-number">0</span>, T = <span class="hljs-number">0</span>, k = <span class="hljs-number">1</span>; k &lt;= nq; k ++ ) {
		<span class="hljs-keyword">while</span> ( L &lt; qry[k].l ) sub ( a[L ++] );
		<span class="hljs-keyword">while</span> ( L &gt; qry[k].l ) add ( a[-- L] );
		<span class="hljs-keyword">while</span> ( R &lt; qry[k].r ) add ( a[++ R] );
		<span class="hljs-keyword">while</span> ( R &gt; qry[k].r ) sub ( a[R --] );
		<span class="hljs-keyword">while</span> ( T != qry[k].t ) {
			<span class="hljs-keyword">if</span> ( T &lt; qry[k].t ) T ++;
			<span class="hljs-keyword">if</span> ( L &lt;= mdf[T].x &amp;&amp; mdf[T].x &lt;= R ) 
				sub ( a[mdf[T].x] ),
				add ( mdf[T].y );
			swap ( a[mdf[T].x], mdf[T].y );
			<span class="hljs-keyword">if</span> ( T &gt; qry[k].t ) T --;
		}
		res[qry[k].id] = RES;
	}
	<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= nq; i ++ ) 
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, res[i]);
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="å›æ»šè«é˜Ÿ">å›æ»šè«é˜Ÿ</h2>
<h3 id="é—®é¢˜ç±»å‹-2">é—®é¢˜ç±»å‹</h3>
<blockquote>
<p>ç»™å®šä¸€ä¸ªæ•°åˆ—ï¼Œå¤šä¸ªæŸ¥è¯¢åŒºé—´æ–°å®šä¹‰çš„æœ€å¤§å€¼<br>
è¿™ç§å¥½å¢åŠ <span style="color: red;">ä¸å¥½åˆ é™¤</span>çš„é—®é¢˜</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥<span style="color: red;">å…¨ä½¿ç”¨å¢åŠ æ“ä½œ</span>æ¥è¿›è¡Œè·‘æŒ‡é’ˆ</p>
<h3 id="æ–°éå†æ–¹æ³•">æ–°éå†æ–¹æ³•</h3>
<p>æˆ‘ä»¬åœ¨å›æ»šè«é˜Ÿä¸­ä¸€æ¬¡è€ƒè™‘ä¸€æ•´ä¸ªå—å…¶ä¸­æ‰€æœ‰çš„è¯¢é—®<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>åœ¨è¯¥å—å†…ç‚¹è¯¢é—®<br>
è¿™äº›è¯¢é—®<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span>é€’å¢</p>
<h3 id="åˆ†ç±»è®¨è®º">åˆ†ç±»è®¨è®º</h3>
<p>è¿™æ ·éå†æ—¶ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š<br>
1.å¼€å§‹æ—¶<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span>åœ¨åŒä¸€ä¸ªå—å†…<br>
2.åé¢<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span>ä¸åœ¨åŒä¸€ä¸ªå—å†…</p>
<p><strong>æƒ…å†µ1ï¼š</strong><br>
ç”±äºä¸€ä¸ªå—å†…é•¿åº¦ä¸è¶…è¿‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mrow><mi>n</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.04em;vertical-align:-0.23972em;"></span><span class="base textstyle uncramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">âˆš</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span></span></span></span> ï¼Œæ‰€ä»¥<span style="color: red;">ç›´æ¥æš´åŠ›</span>å³å¯<br>
ä½†è¿™æ³¢æš´åŠ›æ˜¯æ²¡æœ‰æ”¶ç›Šç‚¹ï¼Œåªèƒ½ç”¨æ¥è®°ä¸€ä¸‹ç­”æ¡ˆï¼Œéå†å®Œè¦æ¸…ä¸€ä¸‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mo>[</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">cnt[]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mclose">]</span></span></span></span> æ•°ç»„<br>
<strong>æƒ…å†µ2ï¼š</strong><br>
æˆ‘ä»¬å°†æŸ¥è¯¢çš„åŒºé—´<span style="color:red;">åˆ†ä¸ºä¸¤éƒ¨åˆ†</span><br>
1.åœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>æ‰€åœ¨çš„å—å†…<br>
å¯¹äºè¿™éƒ¨åˆ†åŒæ ·æˆ‘ä»¬å¯ä»¥æš´åŠ›è§£å†³ï¼Œç»“æŸäº†ä¹Ÿè¦æ¸…ä¸€ä¸‹æ•°ç»„<br>
2.ä¸åœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>æ‰€åœ¨çš„å—å†…<br>
è¿™æ ·çš„æ‰€æœ‰åŒºé—´å·¦ç«¯ç‚¹éƒ½å›ºå®šåœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span>çš„ä¸‹ä¸€ä¸ªå—çš„ç¬¬ä¸€ä¸ªä½ç½®<br>
è¿™äº›åŒºé—´éå†æ—¶åªå‰è¿›å³ç«¯ç‚¹<br>
æˆ‘ä»¬å®Œå…¨å¯ä»¥åªä½¿ç”¨è«é˜Ÿçš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">add</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">d</span></span></span></span> æ“ä½œæ¥å®ç°</p>
<h3 id="æ€æƒ³æ€»ç»“-1">æ€æƒ³æ€»ç»“</h3>
<p>æ—¢ç„¶ä½¿ç”¨åˆ é™¤æ“ä½œå¾ˆéº»çƒ¦ï¼Œé‚£ä¹ˆå°±ä¸ä½¿ç”¨åˆ é™¤æ“ä½œ<br>
å¯¹äºä¸€ä¸ªçŸ­åˆ°ä¸€ä¸ªå—å†…çš„åŒºé—´ï¼Œç›´æ¥ä½¿ç”¨æš´åŠ›æ±‚è§£<br>
å¯¹äºè·¨åŒºé—´çš„å—ï¼Œå°†å…¶æŒ‰å·¦ç«¯ç‚¹å—ç¼–å·åˆ†ç±»ä¹‹åï¼Œå¯ä»¥å°†åŒä¸€ç±»çš„æ¯ä¸ªåŒºé—´åˆ†ä¸ºå·¦è¾¹çš„ä¸åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mrow><mi>n</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8002800000000001em;"></span><span class="strut bottom" style="height:1.04em;vertical-align:-0.23972em;"></span><span class="base textstyle uncramped"><span class="sqrt mord"><span class="sqrt-sign" style="top:0.03971999999999998em;"><span class="style-wrap reset-textstyle textstyle uncramped">âˆš</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span><span style="top:-0.72028em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">â€‹</span></span>â€‹</span></span></span></span></span></span> çš„å°åŒºé—´å’Œå³è¾¹ä¸æ–­å‰è¿›çš„å¤§åŒºé—´ï¼Œå·¦è¾¹æš´åŠ›å³è¾¹è«é˜Ÿå³å¯è§£å†³é—®é¢˜</p>
<h3 id="ç®—æ³•æ¶æ„-2">ç®—æ³•æ¶æ„</h3>
<p>|--è¯»å…¥æ•°æ®ã€æ’åºè¯¢é—®<br>
|--éå†è¯¢é—®<br>
|----å¼€å§‹æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mi>e</mi><mi>t</mi><mo>(</mo><mi>l</mi><mo>)</mo><mo>=</mo><mi>g</mi><mi>e</mi><mi>t</mi><mo>(</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">get(l)=get(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span> ï¼Œç›´æ¥æš´åŠ›<br>
|----åé¢æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mi>e</mi><mi>t</mi><mo>(</mo><mi>l</mi><mo>)</mo><mo>â‰ </mo><mi>g</mi><mi>e</mi><mi>t</mi><mo>(</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">get(l)\neq get(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mrel">â‰ </span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span><br>
|------å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mi>e</mi><mi>t</mi><mo>(</mo><mi>l</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">get(l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> å—ä¸‹çš„éƒ¨åˆ†åŒºé—´è¿›è¡Œæš´åŠ›<br>
|------å¯¹å…¶ä½™éƒ¨åˆ†åŒºé—´è¿›è¡Œè«é˜Ÿé€’è¿› <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">add</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">d</span></span></span></span><br>
|--è¾“å‡ºç­”æ¡ˆ</p>
<blockquote>
<p><a href="">æ´›è°·-P5906ã€Šã€æ¨¡æ¿ã€‘å›æ»šè«é˜Ÿ&amp;ä¸åˆ é™¤è«é˜Ÿã€‹</a></p>
</blockquote>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">int</span> n, m, len;
<span class="hljs-keyword">int</span> w[N], cnt[N];
ll res[N];
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Q</span>{</span>
        <span class="hljs-keyword">int</span> id, l, r;
}q[N];
<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; nums;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{ <span class="hljs-keyword">return</span> x / len;}

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x, ll &amp;RES )</span> </span>{
        cnt[x] ++;
        RES = max ( RES, (ll)cnt[x] * nums[x] );
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ONLINE_JUDGE</span>
        freopen(<span class="hljs-string">&quot;in.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-built_in">stdin</span>);
        freopen(<span class="hljs-string">&quot;out.out&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-built_in">stdout</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;n, &amp;m); len = <span class="hljs-built_in">sqrt</span>(n);
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) 
                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;w[i]), 
                nums.push_back(w[i]);

        <span class="hljs-comment">//ç¦»æ•£åŒ–</span>
        sort ( nums.begin(), nums.end() );
        nums.erase(unique(nums.begin(), nums.end()), nums.end());
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) 
                w[i] = lower_bound(nums.begin(), nums.end(), w[i]) - nums.begin(); 
        
        <span class="hljs-comment">// è¯¢é—®è¯»å…¥ä¸æ’åº</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {
                <span class="hljs-keyword">int</span> l, r; <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);
                q[i] = {i, l, r};
        }
        
        sort ( q, q + m, [] ( Q a, Q b ) {
                <span class="hljs-keyword">if</span> ( get(a.l) != get(b.l) ) <span class="hljs-keyword">return</span> get(a.l) &lt; get(b.l);
                <span class="hljs-keyword">return</span> a.r &lt; b.r;
        });

        <span class="hljs-comment">// éå†è¯¢é—®</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; m; ) {
                <span class="hljs-keyword">int</span> y = x;
                <span class="hljs-keyword">while</span> ( y &lt; m &amp;&amp; get(q[y].l) == get(q[x].l) ) y ++; <span class="hljs-comment">// [x,y-1]çš„åŒºé—´å†…éƒ½æ˜¯.lç›¸ç­‰çš„æŸ¥è¯¢</span>
                <span class="hljs-keyword">int</span> right = get(q[x].l) * len + len - <span class="hljs-number">1</span>; <span class="hljs-comment">// q[x].læ‰€åœ¨çš„å—çš„æœ€åä¸€ä¸ªç‚¹</span>

                <span class="hljs-comment">// q[x].lå’Œq[x].råœ¨åŒä¸€ä¸ªå—å†…ï¼Œç›´æ¥æš´åŠ›æ±‚</span>
                <span class="hljs-keyword">while</span> ( x &lt; y &amp;&amp; q[x].r &lt;= right ) { 
                        ll RES = <span class="hljs-number">0</span>; 
                        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> k = q[x].l; k &lt;= q[x].r; k ++ ) add ( w[k], RES );
                        res[q[x].id] = RES;
                        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> k = q[x].l; k &lt;= q[x].r; k ++ ) cnt[w[k]] --; <span class="hljs-comment">// å›åˆ°æ›´æ–°å‰çš„æ•°æ®çŠ¶æ€</span>
                        x ++;
                }
                
                <span class="hljs-comment">// æ±‚åœ¨ä¸åŒå—å†…çš„è¯¢é—®</span>
                ll RES = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">int</span> i = right, j = right + <span class="hljs-number">1</span>; <span class="hljs-comment">// å³ç«¯ç‚¹å’Œå·¦ç«¯ç‚¹</span>
                <span class="hljs-keyword">while</span> ( x &lt; y ) {
                        <span class="hljs-keyword">while</span> ( i &lt; q[x].r ) add ( w[ ++ i ], RES ); <span class="hljs-comment">// å³ç«¯ç‚¹ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®</span>
                        ll backup = RES; <span class="hljs-comment">// å¤‡ä»½ä¸€ä¸‹</span>
                        <span class="hljs-keyword">while</span> ( j &gt; q[x].l ) add ( w[ -- j ], RES ); <span class="hljs-comment">// å·¦ç«¯ç‚¹ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®</span>
                        res[q[x].id] = RES;
                        <span class="hljs-keyword">while</span> ( j &lt; right + <span class="hljs-number">1</span> ) cnt[w[j ++]] --; <span class="hljs-comment">// å·¦ä¾§å›åˆ°æ›´æ–°å‰çš„æ•°æ®çŠ¶æ€ï¼Œå› ä¸ºå·¦ä¾§ä¸åˆ è¦é‡å¼€</span>
                        RES = backup; <span class="hljs-comment">// æ¢å¤å¤‡ä»½</span>
                        x ++;
                }
                <span class="hljs-built_in">memset</span> ( cnt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> cnt ); <span class="hljs-comment">// è¿›è¡Œä¸‹ä¸€éƒ¨åˆ†çš„æŸ¥è¯¢å‰è¦æ¸…ç©º</span>
        }
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, res[i]);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="æ ‘ä¸Šè«é˜Ÿ">æ ‘ä¸Šè«é˜Ÿ</h2>
<h3 id="é—®é¢˜ç±»å‹-3">é—®é¢˜ç±»å‹</h3>
<p>ç»™ä¸€ä¸ªæ— æ ¹æ™®é€šæ ‘ï¼Œè‹¥å¹²è¯¢é—®ï¼Œæ ‘çš„æŸæ¡è·¯å¾„ä¸Šä¸€å…±æœ‰å¤šå°‘ç§ä¸åŒæƒé‡
<img src="https://i.loli.net/2021/09/11/eCVfYKyq9wjRgWE.png">
æƒå€¼ï¼š</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr>
<td>45</td>
<td>2</td>
<td>9</td>
<td>1</td>
<td>8</td>
<td>5</td>
<td>7</td>
<td>7</td>
</tr>
</tbody>
</table>
<p>æ ‘ä¸Šçš„ä¿®æ”¹é—®é¢˜ï¼Œå¯ä»¥å˜æˆä¸€ä¸ªçº¿æ€§åŒºé—´ä¿®æ”¹é—®é¢˜<br>
åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨æ¬§æ‹‰åºåˆ—</p>
<h3 id="æ¬§æ‹‰åºåˆ—">æ¬§æ‹‰åºåˆ—</h3>
<h4 id="æ„é€ æ–¹å¼">æ„é€ æ–¹å¼</h4>
<p><strong><span style="color: red;">å¯¹æ ‘DFSä¸€æ¬¡ï¼Œæ­£åºéå†åˆ°æ¯ä¸ªèŠ‚ç‚¹æ—¶è®°å½•ä¸€æ¬¡ï¼Œååºéå†å†è®°å½•ä¸€æ¬¡</span></strong><br>
<span style="color:blue;">æ¯”å¦‚ä¸Šé¢çš„æ ‘å¯ä»¥å˜ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">5</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">5</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">6</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">6</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">7</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">7</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">4</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">4</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span></span></p>
<h4 id="æ€§è´¨">æ€§è´¨</h4>
<p>1.æ¯ä¸ªç‚¹è¿›å…¥å†™ä¸€æ¬¡ï¼Œç¦»å¼€å†™ä¸€æ¬¡ï¼Œå…±å†™ä¸¤æ¬¡<br>
2.æ¯æ¬¡è¯¢é—®è·¯å¾„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>x</mi><mo>â†’</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(x\rightarrow y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mrel">â†’</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> é€‰åºåˆ—ä¸­xæœ€å¼€å§‹(æœ€å)å‡ºç°çš„ä½ç½®å’Œyæœ€å¼€å§‹å‡ºç°çš„ä½ç½®ï¼Œåªä¿ç•™ä¸­é—´å‡ºç°è¿‡ä¸€æ¬¡çš„æ•°</p>
<h4 id="æ“ä½œæ–¹å¼">æ“ä½œæ–¹å¼</h4>
<p>ä¸¤ä¸ªæ•°ç»„<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">first[u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">u</span></span></span></span> ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">last[u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">u</span></span></span></span> ç¬¬äºŒæ¬¡å‡ºç°çš„ä½ç½®<br>
é€‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x,y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> æ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> ä¹‹å‰å‡ºç°ï¼Œå³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo>&lt;</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">first[x]\lt first[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span><span class="mrel">&lt;</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">]</span></span></span></span></p>
<h3 id="åˆ†ç±»è®¨è®º-1">åˆ†ç±»è®¨è®º</h3>
<ol>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mi>a</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">lca(x,y)=x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">x</span></span></span></span> ï¼Œåˆ™æ¬§æ‹‰åºåˆ—ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo>â†’</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">first[x]\rightarrow first[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span><span class="mrel">â†’</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">]</span></span></span></span> ä¸­é—´åªå‡ºç°ä¸€æ¬¡çš„ç‚¹å¯¹åº” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>â†’</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x\rightarrow y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class="mrel">â†’</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> çš„è·¯å¾„<span style="color: blue">ï¼ˆå› ä¸ºè‹¥å‡ºç°0æ¬¡è¯´æ˜æ²¡æœåˆ°ï¼Œè‹¥å‡ºç°ä¸¤æ¬¡è¯´æ˜è¿›å»æœäº†ä½†æ˜¯ä¸å­˜åœ¨</span></li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mi>a</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>â‰ </mo><mi>x</mi></mrow><annotation encoding="application/x-tex">lca(x,y)\neq x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">â‰ </span><span class="mord mathit">x</span></span></span></span> ï¼Œåˆ™è·¯å¾„å¯¹åº”æ¬§æ‹‰åºåˆ—ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo>â†’</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo>[</mo><mi>y</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">last[x]\rightarrow first[y]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span><span class="mrel">â†’</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">]</span></span></span></span> ä¸­åªå‡ºç°ä¸€æ¬¡çš„ç‚¹ä»¥åŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mi>a</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">lca(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> <span style="color: blue;">ï¼ˆå› ä¸ºæœ€åçš„lcaä»æœªå›æº¯</span></li>
</ol>
<h3 id="æŒ‡é’ˆç§»åŠ¨-1">æŒ‡é’ˆç§»åŠ¨</h3>
<p>ä¸‰ä¸ªæ•°ç»„<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mo>[</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">cnt[]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">c</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mclose">]</span></span></span></span> è®°å½•æƒå€¼å‡ºç°çš„ä¸ªæ•°<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>t</mi><mo>[</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">st[]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mclose">]</span></span></span></span> è®°å½•åºå·å‡ºç°çš„æ¬¡æ•°(0/1)ï¼Œ<span style="color: red;">æ›´æ–°ï¼š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>t</mi><mo>[</mo><msup><mo>]</mo><mo>=</mo></msup><mn>1</mn></mrow><annotation encoding="application/x-tex">st[]^=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mopen">[</span><span class="mclose"><span class="mclose">]</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mrel">=</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathrm">1</span></span></span></span> </span><br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">res</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span> å®æ—¶è®°å½•ç­”æ¡ˆ</p>
<pre><code class="language-cpp"><div><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span> <span class="hljs-params">( x )</span> </span>{
        st[x] ^= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> ( st[x] == <span class="hljs-number">0</span> ) res -= ! -- cnt[a[x]];
        <span class="hljs-keyword">else</span>              res -= ! cnt[a[x]] --;
}
</div></code></pre>
<p>ç”±äºå‡å»ä¸€ä¸ªæ•°ä¹Ÿæ˜¯å¼‚æˆ–1ï¼Œæ‰€ä»¥ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">add</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">d</span></span></span></span> å°±å¤Ÿç”¨äº†</p>
<h3 id="æ€æƒ³æ€»ç»“-2">æ€æƒ³æ€»ç»“</h3>
<p>å¯¹äºä¸€ä¸ªæ ‘ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬ä¸»è¦åˆ©ç”¨æ¬§æ‹‰åºåˆ—æŠŠå®ƒå˜æˆåŒºé—´é—®é¢˜<br>
ç„¶åå¯¹äºæ¬§æ‹‰åºåˆ—æ€§è´¨ï¼ˆæœ‰å…³lcaï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºæˆ‘ä»¬æ¯æ¬¡è¦å›ºå®šå“ªä¸ªåŒºé—´å’Œå“ªäº›æ•°</p>
<h3 id="ç®—æ³•æ¶æ„-3">ç®—æ³•æ¶æ„</h3>
<p>|--æ±‚æ¬§æ‹‰åºåˆ—<br>
|--æ±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">lca</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span></span></span></span><br>
|----é¢„å¤„ç† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mo>]</mo><mo>[</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">f[][]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mclose">]</span><span class="mopen">[</span><span class="mclose">]</span></span></span></span><br>
|----å€å¢å‘ä¸Šè·³æ‰¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">lca</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mord mathit">a</span></span></span></span><br>
|--æ ‘ä¸Šè¯¢é—® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.36687em;"></span><span class="strut bottom" style="height:0.36687em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mrel">â†’</span></span></span></span> åºåˆ—è¯¢é—®<br>
|--è«é˜Ÿ</p>
<blockquote>
<p><a href="https://www.acwing.com/problem/content/2536/">AcWing-2534 ã€Šæ ‘ä¸Šè®¡æ•°2ã€‹</a></p>
</blockquote>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">100010</span>;

<span class="hljs-keyword">int</span> n, m, len;
<span class="hljs-keyword">int</span> w[N]; <span class="hljs-comment">// è¯»å…¥ç‚¹æƒ</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Edge</span> {</span> <span class="hljs-keyword">int</span> nxt, to; } edge[N]; <span class="hljs-keyword">int</span> head[N], tot; 
<span class="hljs-keyword">int</span> depth[N], f[N][<span class="hljs-number">16</span>]; <span class="hljs-comment">// å€å¢lcaé‚£ä¸€å¥—</span>
<span class="hljs-keyword">int</span> seq[N], top, first[N], last[N]; <span class="hljs-comment">// æ¬§æ‹‰åºåˆ—ï¼Œå½“å‰ä½ç½®å‡ºç°çš„ä¸ªæ•°ï¼Œæœ€æ—©å‡ºç°çš„ä½ç½®å’Œæœ€åå‡ºç°çš„ä½ç½®</span>
<span class="hljs-keyword">int</span> cnt[N], st[N], res[N]; <span class="hljs-comment">// æƒå€¼ä¸åŒä¸ªæ•°ï¼Œåºå·å‡ºç°çš„ä¸ªæ•°ï¼ˆå¥‡æ•°/å¶æ•°ï¼‰ï¼Œç­”æ¡ˆè®°å½•</span>
<span class="hljs-keyword">int</span> que[N]; <span class="hljs-comment">// å®½æœé˜Ÿåˆ—</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Qry</span> {</span>
        <span class="hljs-keyword">int</span> id, l, r; <span class="hljs-comment">// ç¬¬idä¸ªæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åŒºé—´æ˜¯l, r</span>
        <span class="hljs-keyword">int</span> p; <span class="hljs-comment">// æœ‰æ— æœ€è¿‘å…¬å…±ç¥–å…ˆ</span>
}q[N];
<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; nums; <span class="hljs-comment">// ç¦»æ•£åŒ–</span>
<span class="hljs-keyword">int</span> RES; <span class="hljs-comment">// ç­”æ¡ˆå®æ—¶è®¡æ•°</span>

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Add_Edge</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> from, <span class="hljs-keyword">int</span> to )</span> </span>{
        edge[ ++ tot ] = {head[from], to};
        head[from] = tot;
}

<span class="hljs-comment">// -----------------------------------------------------------------æ±‚æ¬§æ‹‰åºåˆ—</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> father )</span> </span>{
        seq[ ++ top ] = u;
        first[u] = top;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = head[u]; ~i; i = edge[i].nxt ) {
                <span class="hljs-keyword">int</span> j = edge[i].to;
                <span class="hljs-keyword">if</span> ( j != father ) dfs ( j, u );
        } 
        seq[ ++ top ] = u;
        last[u] = top;
}
<span class="hljs-comment">// ---------------------------------------------------------------------------</span>

<span class="hljs-comment">// -------------------------------------------------------------------é¢„å¤„ç†å€å¢lca</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">lca</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b )</span> </span>{
        <span class="hljs-keyword">if</span> ( depth[a] &lt; depth[b] ) swap ( a, b );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> k = <span class="hljs-number">15</span>; k &gt;= <span class="hljs-number">0</span>; k -- ) 
                <span class="hljs-keyword">if</span> ( depth[f[a][k]] &gt;= depth[b] ) 
                        a = f[a][k];
        <span class="hljs-keyword">if</span> ( a == b ) <span class="hljs-keyword">return</span> a;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> k = <span class="hljs-number">15</span>; k &gt;= <span class="hljs-number">0</span>; k -- ) 
                <span class="hljs-keyword">if</span> ( f[a][k] != f[b][k] ) 
                        a = f[a][k],
                        b = f[b][k];
        <span class="hljs-keyword">return</span> f[a][<span class="hljs-number">0</span>];
}

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bfs</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">memset</span> ( depth, <span class="hljs-number">0x3f</span>, <span class="hljs-keyword">sizeof</span> depth );
        depth[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>, depth[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> hh = <span class="hljs-number">0</span>, tt = <span class="hljs-number">0</span>;
        que[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> ( hh &lt;= tt ) {
                <span class="hljs-keyword">int</span> t = que[hh ++ ];
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = head[t]; ~i; i = edge[i].nxt ) {
                        <span class="hljs-keyword">int</span> to = edge[i].to;
                        <span class="hljs-keyword">if</span> ( depth[to] &gt; depth[t] + <span class="hljs-number">1</span> ) {
                                depth[to] = depth[t] + <span class="hljs-number">1</span>;
                                f[to][<span class="hljs-number">0</span>] = t;
                                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>; k &lt;= <span class="hljs-number">15</span>; k ++ ) {
                                        f[to][k] = f[f[to][k - <span class="hljs-number">1</span>]][k - <span class="hljs-number">1</span>];
                                }
                                que[ ++ tt ] = to;
                        }
                }
        }
}
<span class="hljs-comment">// ------------------------------------------------------------------------------------</span>

<span class="hljs-comment">// ----------------------------------------------------------------------------- è«é˜Ÿæ“ä½œ</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{ <span class="hljs-keyword">return</span> x / len; }

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{
        st[x] ^= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> ( st[x] == <span class="hljs-number">0</span> ) {
                cnt[w[x]] --;
                <span class="hljs-keyword">if</span> ( !cnt[w[x]] ) RES --;
        } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> ( !cnt[w[x]] ) RES ++;
                cnt[w[x]] ++;
        }
}
<span class="hljs-comment">// ------------------------------------------------------------------------------------</span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ONLINE_JUDGE</span>
        freopen(<span class="hljs-string">&quot;in.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-built_in">stdin</span>);
        freopen(<span class="hljs-string">&quot;out.out&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-built_in">stdout</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
        <span class="hljs-comment">// è¯»å…¥æ•°æ®å¹¶è¿›è¡Œç¦»æ•£åŒ–</span>
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) 
                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;w[i]), 
                nums.push_back(w[i]);
        sort ( nums.begin(), nums.end() );
        nums.erase(unique(nums.begin(), nums.end()), nums.end());
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) {
                w[i] = lower_bound(nums.begin(), nums.end(), w[i]) - nums.begin();
        }

        <span class="hljs-comment">// å»ºå›¾</span>
        <span class="hljs-built_in">memset</span>(head, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> head);
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i ++ ) {
                <span class="hljs-keyword">int</span> a, b; <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);
                Add_Edge ( a, b );
                Add_Edge ( b, a );
        }

        <span class="hljs-comment">// æ±‚æ¬§æ‹‰åºåˆ—</span>
        dfs ( <span class="hljs-number">1</span>, <span class="hljs-number">-1</span> );
        <span class="hljs-comment">// é¢„å¤„ç†æœ€è¿‘å…¬å…±ç¥–å…ˆ</span>
        bfs ();
        
        <span class="hljs-comment">// è¯¢é—®</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {
                <span class="hljs-keyword">int</span> a, b; <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>, &amp;a, &amp;b); 
                <span class="hljs-comment">// è½¬ç§»æˆçº¿æ€§åŒºé—´é—®é¢˜</span>
                <span class="hljs-keyword">if</span> ( first[a] &gt; first[b] ) swap ( a, b );
                <span class="hljs-keyword">int</span> p = lca ( a, b );
                <span class="hljs-keyword">if</span> ( a == p ) q[i] = {i, first[a], first[b]};
                <span class="hljs-keyword">else</span> q[i] = {i, last[a], first[b], p};
        }

        <span class="hljs-comment">// åˆ†å—æ’åº</span>
        len = <span class="hljs-built_in">sqrt</span> ( top );
        sort ( q, q + m, [&amp;]( Qry a, Qry b ) {
                <span class="hljs-keyword">if</span> ( get(a.l) != get(b.l) ) <span class="hljs-keyword">return</span> get(a.l) &lt; get(b.l);
                <span class="hljs-keyword">if</span> ( get(a.l) &amp; <span class="hljs-number">1</span> ) <span class="hljs-keyword">return</span> a.r &lt; b.r;
                <span class="hljs-keyword">else</span>                <span class="hljs-keyword">return</span> a.r &gt; b.r;
        });
        
        <span class="hljs-comment">// è«é˜ŸæŒ‡é’ˆæ“ä½œ</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, L = <span class="hljs-number">1</span>, R = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {
                <span class="hljs-keyword">int</span> id = q[i].id, l = q[i].l, r = q[i].r, p = q[i].p;
                <span class="hljs-keyword">while</span> ( R &lt; r ) add ( seq[ ++ R ] );
                <span class="hljs-keyword">while</span> ( R &gt; r ) add ( seq[ R -- ] );
                <span class="hljs-keyword">while</span> ( L &lt; l ) add ( seq[ L ++ ] );
                <span class="hljs-keyword">while</span> ( L &gt; l ) add ( seq[ -- L ] );
                <span class="hljs-keyword">if</span> ( p ) add ( p ); <span class="hljs-comment">// å¦‚æœxä¸æ˜¯yçš„å…¬å…±ç¥–å…ˆçš„è¯è¦å…ˆåŠ ä¸Šå†å‡å»</span>
                res[id] = RES;
                <span class="hljs-keyword">if</span> ( p ) add ( p );
        }

        <span class="hljs-comment">// è¾“å‡ºç­”æ¡ˆ</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) 
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, res[i]);

        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<h2 id="äºŒæ¬¡ç¦»çº¿è«é˜Ÿ">äºŒæ¬¡ç¦»çº¿è«é˜Ÿ</h2>
<h3 id="é—®é¢˜ç±»å‹-4">é—®é¢˜ç±»å‹</h3>
<blockquote>
<p>å®šä¹‰ä¸€ä¸ªæ–°çš„é…å¯¹å«ä¹‰ï¼šä¸¤ä¸ªæ•°å¼‚æˆ–åäºŒè¿›åˆ¶è¡¨ç¤ºæœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>
é•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> çš„åºåˆ—ï¼Œä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> ï¼Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">m</span></span></span></span> æ¬¡è¯¢é—® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> å†…æœ‰å¤šå°‘ä¸ªæ•°å¯¹é…å¯¹<br>
è¿™ç±»é—®é¢˜æ¯æ¬¡æŒ‡é’ˆç§»åŠ¨ä¹‹åå¯¹æ•°æ®çš„ä¿®æ”¹å€¼éå¸¸éš¾ç®—</p>
</blockquote>
<p>è¿™ç±»é—®é¢˜å¯ä»¥æŠŠä¸€ä¸ªé—®é¢˜æ¨å¯¼æˆä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªé—®é¢˜ä½¿ç”¨è«é˜Ÿç¦»çº¿ç›´æ¥ç®—å‡ºåï¼Œå¯¹å¦ä¸€ä¸ªé—®é¢˜å†æ‹å‡ºæ¥ç¦»çº¿ç®—ä¸€æ¬¡</p>
<h3 id="éå†åˆ†ç±»">éå†åˆ†ç±»</h3>
<p>å¯¹äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>L</mi><mo separator="true">,</mo><mspace width="0.277778em"></mspace><mi>R</mi><mo>âŸ¶</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[L,\;R\longrightarrow r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">L</span><span class="mpunct">,</span><span class="mord mspace thickspace"></span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mrel">âŸ¶</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span></p>
<p>åŸæ˜¯æ€æƒ³æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span> å‘åç§»åŠ¨å¹¶åŠ å…¥ä¸€ä¸ªæ•°ï¼Œçœ‹<span style="color:red;">åŠ å…¥çš„è¿™ä¸ªæ•°å¯¹ç­”æ¡ˆä¼šä¸ä¼šäº§ç”Ÿä»€ä¹ˆä»·å€¼æˆ–å½±å“</span><br>
åœ¨è¿™é‡ŒåŠ å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span> æ—¶ï¼Œçœ‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span> è¿™ä¸ªä½ç½®ä¸Šçš„æ•°èƒ½å’ŒåŸåŒºé—´å†…å¤šå°‘ä¸ªå…ƒç´ <span style="color:red;">äº§ç”Ÿé…å¯¹</span></p>
<p>æˆ‘ä»¬ä»¤  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">S[R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span>  è¡¨ç¤º  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[1,R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span>  ä¸­å¤šå°‘ä¸ªæ•°ä¸  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mbin">+</span><span class="mord mathrm">1</span></span></span></span>  ä½ç½®é…å¯¹ï¼Œåˆ™ä¸Šé—®é¢˜çš„æ±‚æ³•å°±æ˜¯<span style="color:red;"> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>R</mi><mo>]</mo><mo>âˆ’</mo><mi>S</mi><mo>[</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">S[R]-S[L-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span><span class="mbin">âˆ’</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span> </span></p>
<p>è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">f[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>[</mo><mn>1</mn><mo>]</mo><mtext>Â </mtext><mi>w</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">w[1]~w[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mord mspace">Â </span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> ä¸­æœ‰å¤šå°‘ä¸ªæ•°ä¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">w[i+1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span> é…å¯¹ï¼Œæ‰€ä»¥é—®é¢˜å…³é”®æŒ‡å‘<span style="color: red;">é¢„å¤„ç† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">f[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> </span><br>
è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> è¡¨ç¤ºå‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> ä¸ªæ•°ä¸­æœ‰å¤šå°‘ä¸ªä¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> é…å¯¹ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>=</mo><mi>g</mi><mo>[</mo><mi>w</mi><mo>[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>]</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">f[i]=g[w[i+1]]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mclose">]</span></span></span></span><br>
å¯¹äºæ¯æ¬¡åŠ å…¥ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>[</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">w[i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span></span></span></span> æˆ‘ä»¬è¦å¯»æ‰¾å“ªäº›æ•°å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> é…å¯¹ï¼Œè®©ä»–ä»¬çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>(</mo><mo>)</mo><mo>+</mo><mo>+</mo></mrow><annotation encoding="application/x-tex">g()++</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord">+</span></span></span></span><br>
æ‰€ä»¥æˆ‘ä»¬è¦å»ºä¸€ä¸ªæ•°ç»„å­˜æ”¾æ‰€æœ‰å­˜åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> çš„æ•°<br>
è¦æ‰¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>âŠ—</mo><mi>x</mi><mo>=</mo><mi>y</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>â‡’</mo><mi>x</mi><mo>=</mo><mi>w</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>âŠ—</mo><mi>y</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">w[i]\otimes x=y[i]\Rightarrow x=w[i]\otimes y[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mbin">âŠ—</span><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mrel">â‡’</span><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mbin">âŠ—</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> éå†æ‰€æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">y[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> å¾—åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span></span></span></span> è¦åŠ çš„æ•°ï¼Œæ‰€ä»¥æ˜¯å¯¹<span style="color: red;"> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>w</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>âŠ—</mo><mi>y</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>]</mo><mo>+</mo><mo>+</mo></mrow><annotation encoding="application/x-tex">g[w[i]\otimes y[i]]++</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mbin">âŠ—</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord">+</span></span></span></span> </span><br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> è¿™ä¹ˆæ±‚ï¼Œé‚£ä¹ˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">f[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span></span></span></span> ä¹Ÿå‡ºæ¥äº†</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ´</mo><mi>S</mi><mo>[</mo><mi>R</mi><mo>]</mo><mo>=</mo><mi>f</mi><mo>[</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\therefore S[R]=f[R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mrel amsrm">âˆ´</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">S[L-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>ç¦»çº¿æ±‚</p>
<p>æˆ‘ä»¬åœ¨æ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>â†’</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">R\rightarrow r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mrel">â†’</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span> æ—¶ï¼Œæ¯ä¸ªæ•°åŠ è¿›æ¥éƒ½æ±‚ä¸€æ¬¡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">S[L-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span><br>
é‚£ä¹ˆå°±æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[1,L-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span> æ¯æ¬¡éƒ½é…å¯¹ä¸€ä¸‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>R</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[R+1,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> çš„æ•°<br>
å¯å°†è¿™äº›é—®é¢˜æ‹¿å‡ºæ¥ï¼Œæ¯ä¸ªé—®é¢˜ï¼šæŸä¸ªå›ºå®šå‰ç¼€ä¸­ï¼ŒæŸä¸ªåŒºé—´æ¯ä¸ªæ•°å’Œè¿™ä¸ªå‰ç¼€ä¸­å¤šå°‘ä¸ªæ•°é…å¯¹<br>
ä»å‰å¾€åæ±‚å‰ç¼€å³å‰ç¼€æ˜¯<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>çš„å“ªäº›è¯¢é—®å¯ä»¥å¹²æ‰ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span>çš„å“ªäº›è¯¢é—®å¯ä»¥å¹²æ‰ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span>çš„ï¼Œ......<br>
è¿™äº›éƒ½å¯ä»¥ç¦»çº¿åšä¸€éå‡ºæ¥</p>
<p>é‚£ä¹ˆç¬¬ä¸€æ¬¡ç¦»çº¿å¾—åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>R</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">S[R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span> ï¼Œå†ç¦»çº¿ä¸€æ¬¡ç»Ÿä¸€å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">S[L-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span><br>
<span style="color: red;">æ³¨ï¼šæ¯æ¬¡æ±‚çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>[</mo><mi>R</mi><mo>âˆ’</mo><mi>S</mi><mo>[</mo><mi>L</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">S[R-S[L-1]]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mbin">âˆ’</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">[</span><span class="mord mathit">L</span><span class="mbin">âˆ’</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mclose">]</span></span></span></span> æ˜¯å¢é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">add</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">d</span></span></span></span> çš„æ•°å€¼</span></p>
<blockquote>
<p>å¯¹äºå…¶ä»–çš„åˆ†ç±»è®¨è®ºæƒ…å†µä¹ŸåŒç†</p>
</blockquote>
<h3 id="ç®—æ³•æ¡†æ¶">ç®—æ³•æ¡†æ¶</h3>
<p>|--é—®é¢˜æ¨å¯¼è½¬åŒ–ï¼Œåšä¸€ä¸ªå‰ç¼€å’Œåˆ†æˆä¸¤ä¸ªé—®é¢˜å»è§£<br>
|--è¯»å…¥æ•°æ®è¯»å…¥è¯¢é—®æ’åº<br>
|--éå†<br>
|----ç¬¬ä¸€æ¬¡è«é˜Ÿéå†æ±‚ç¬¬ä¸€ä¸ªé—®é¢˜<br>
|----ç¬¬äºŒæ¬¡é¡ºåºéå†æ±‚ç¬¬äºŒä¸ªé—®é¢˜<br>
|--åˆå¹¶ç­”æ¡ˆè¾“å‡º</p>
<blockquote>
<p><a href="https://www.luogu.com.cn/problem/P4887">ã€æ¨¡æ¿ã€‘è«é˜ŸäºŒæ¬¡ç¦»çº¿ï¼ˆç¬¬åå››åˆ†å—(å‰ä½“)ï¼‰</a></p>
</blockquote>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">100010</span>;
<span class="hljs-keyword">int</span> n, m, k, len;
<span class="hljs-keyword">int</span> w[N];
ll res[N];
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Q</span> {</span>
        <span class="hljs-keyword">int</span> id, l, r;
        ll RES; <span class="hljs-comment">// å…ˆå­˜ä¸€ä¸‹ï¼Œåˆ†æˆä¸¤æ¬¡æ±‚å¾—</span>
} q[N];
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Range</span> {</span> <span class="hljs-comment">// å¾…è§£å†³é—®é¢˜</span>
        <span class="hljs-keyword">int</span> id, l, r;
        <span class="hljs-keyword">int</span> t; <span class="hljs-comment">// åˆ¤æ–­è¦åŠ è¿˜æ˜¯å‡</span>
};
<span class="hljs-built_in">vector</span>&lt;Range&gt; range[N]; <span class="hljs-comment">// å¯¹äºæ¯ä¸ªå‰ç¼€å¯èƒ½ä¼šæœ‰å¤šä¸ªè¯¢é—®åŒºé—´</span>
<span class="hljs-keyword">int</span> f[N], g[N]; <span class="hljs-comment">// æ¨çš„å…¬å¼å…³ç³»çš„éœ€è¦çš„æ•°ç»„</span>

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{ <span class="hljs-keyword">return</span> x / len; }

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_count</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{ <span class="hljs-comment">// æœ‰å¤šå°‘ä¸ª1</span>
        <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> ( x ) res += x &amp; <span class="hljs-number">1</span>, x &gt;&gt;= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> res;
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ONLINE_JUDGE</span>
        freopen(<span class="hljs-string">&quot;in.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-built_in">stdin</span>);
        freopen(<span class="hljs-string">&quot;out.out&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-built_in">stdout</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;k);
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;w[i]);
        
        <span class="hljs-comment">// å­˜æ”¾æ‰€æœ‰æœ‰kä¸ª1çš„æ•°</span>
        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; nums; 
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">14</span>; i ++ )
                <span class="hljs-keyword">if</span> ( get_count(i) == k ) 
                        nums.push_back(i);
        
        <span class="hljs-comment">// åˆå§‹åŒ–fgæ•°ç»„</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">auto</span> x : nums ) g[w[i] ^ x] ++; <span class="hljs-comment">// æ±‚å½“å‰æ–°åŠ çš„è¿™ä¸ªæ•°ï¼ˆw[i]ï¼‰å¯¹äºå“ªäº›xæ˜¯æœ‰å½±å“çš„</span>
                f[i] = g[w[i + <span class="hljs-number">1</span>]]; <span class="hljs-comment">// å…¬å¼å…³ç³»</span>
        }

        <span class="hljs-comment">// è¯»å…¥è¯¢é—®ï¼Œæ’åº</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {
                <span class="hljs-keyword">int</span> l, r; <span class="hljs-built_in">cin</span> &gt;&gt; l &gt;&gt; r;
                q[i] = {i, l, r};
        }
        len = <span class="hljs-built_in">sqrt</span> ( n );
        sort ( q, q + m, [] ( Q a ,Q b ) {
                <span class="hljs-keyword">if</span> ( get(a.l) != get(b.l) ) <span class="hljs-keyword">return</span> get(a.l) &lt; get(b.l);
                <span class="hljs-keyword">return</span> a.r &lt; b.r;
        });

        <span class="hljs-comment">// è«é˜Ÿ</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, L = <span class="hljs-number">1</span>, R = <span class="hljs-number">0</span>; i &lt; m; i ++ ) {

                <span class="hljs-comment">// S_R - S_{L - 1}</span>
                <span class="hljs-keyword">if</span> ( R &lt; q[i].r ) range[L - <span class="hljs-number">1</span>].push_back({i, R + <span class="hljs-number">1</span>, q[i].r, <span class="hljs-number">-1</span>}); <span class="hljs-comment">// [R + 1, r] å…ˆä¸å¤„ç†ï¼ŒåŠ å…¥è¯¢é—®</span>
                <span class="hljs-keyword">while</span> ( R &lt; q[i].r ) q[i].RES += f[ R ++ ];

                <span class="hljs-comment">// - ( S_{R - 1} - S_{L - 1} )</span>
                <span class="hljs-keyword">if</span> ( R &gt; q[i].r ) range[L - <span class="hljs-number">1</span>].push_back({i, q[i].r + <span class="hljs-number">1</span>, R, <span class="hljs-number">1</span>}); <span class="hljs-comment">// [r + 1, R] å…ˆä¸å¤„ç†ï¼Œ åŠ å…¥è¯¢é—®</span>
                <span class="hljs-keyword">while</span> ( R &gt; q[i].r ) q[i].RES -= f[ -- R ];

                <span class="hljs-comment">// - ( S_R - S_L )</span>
                <span class="hljs-keyword">if</span> ( L &lt; q[i].l ) range[R].push_back({i, L, q[i].l - <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>}); <span class="hljs-comment">// [L, l - 1] å…ˆä¸å¤„ç†ï¼Œ åŠ å…¥è¯¢é—®</span>
                <span class="hljs-keyword">while</span> ( L &lt; q[i].l ) q[i].RES += f[L - <span class="hljs-number">1</span>] + !k, L ++; <span class="hljs-comment">// å› ä¸ºå­˜çš„æ˜¯[1, L - 1]æœ‰å¤šå°‘ä¸ªä¸Lé…å¯¹ï¼Œæ‰€ä»¥è¦å¤šåŠ ä¸ªåˆ¤æ–­w_Læ˜¯å¦é…å¯¹(k!=0)</span>

                <span class="hljs-keyword">if</span> ( L &gt; q[i].l ) range[R].push_back({i, q[i].l, L - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>}); <span class="hljs-comment">// [l, L - 1] å…ˆä¸å¤„ç†ï¼Œ åŠ å…¥è¯¢é—®</span>
                <span class="hljs-keyword">while</span> ( L &gt; q[i].l ) q[i].RES -= f[L - <span class="hljs-number">2</span>] + !k, L --;
        }

        <span class="hljs-comment">// æ•´ä½“æ±‚ä¸€ä¸‹æ²¡æ±‚çš„éƒ¨åˆ†</span>
        <span class="hljs-built_in">memset</span> ( g, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> g );
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) { <span class="hljs-comment">// æšä¸¾æ¯ä¸ªå‰ç¼€</span>
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">auto</span> x : nums ) g[w[i] ^ x] ++; <span class="hljs-comment">// æšä¸¾æ‰€æœ‰æ»¡è¶³è¦æ±‚çš„y</span>
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">auto</span>&amp; rg : range[i] ) {
                        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> x = rg.l; x &lt;= rg.r; x ++ )
                                q[rg.id].RES += g[w[x]] * rg.t;
                }
        }

        <span class="hljs-comment">// å› ä¸ºæ¯æ¬¡æ±‚çš„æ˜¯å¢é‡ï¼Œæ‰€ä»¥è¦ç´¯åŠ å‰ç¼€å’Œ</span>
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; m; i ++ ) q[i].RES += q[i - <span class="hljs-number">1</span>].RES;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) res[q[i].id] = q[i].RES;


        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i ++ ) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, res[i]);
}
</div></code></pre>
    </body>
