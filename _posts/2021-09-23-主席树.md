---
layout: post
title: ä¸»å¸­æ ‘
subtitle: è¦å¯ä»¥ç›´æ¥è®¿é—®åˆ°æ¯ä¸€æ¬¡çº¿æ®µæ ‘çš„æ”¹å˜ï¼ŸğŸ¤”
categories: æ•°æ®ç»“æ„
tags: [æ•°æ®ç»“æ„]
---

<head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
	<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
	</style>
        <style>
		.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
	</style>
</head>
<body class="vscode-body vscode-light">
        <h2 id="å®šä¹‰">å®šä¹‰</h2>
<p>å¯æŒä¹…åŒ–çº¿æ®µæ ‘ä¹Ÿå«<span style="color: red;">å‡½æ•°å¼çº¿æ®µæ ‘</span>ã€ä¸»å¸­æ ‘<br>
å…¶å¯¹äºæ¯ä¸ªä¿®æ”¹å¹¶ä¸æ˜¯ç›´æ¥å¯¹ä¸€ä¸ªèŠ‚ç‚¹æ›´æ”¹å®ƒçš„å€¼<br>
è€Œæ˜¯å¯¹äºè¿™ä¸ªèŠ‚ç‚¹é¢å¤–åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºå®ƒä¿®æ”¹åçš„å€¼ï¼Œä¹Ÿè¢«ç§°ä¸ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬èŠ‚ç‚¹<br>
å¯¹äºè¿™ä¸ªç‰ˆæœ¬èŠ‚ç‚¹ï¼Œä¾ç„¶<span style="color: red;">å¯ä»¥ç›´æ¥è®¿é—®å®ƒçš„å·¦å³å­èŠ‚ç‚¹ã€ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®å®ƒ</span></p>
<h2 id="å¯æŒä¹…å‰æ">å¯æŒä¹…å‰æ</h2>
<p>æœ¬èº«çš„æ‹“æ‰‘ç»“æ„åœ¨æ•´ä¸ªæ“ä½œä¸­ä¿æŒä¸å˜</p>
<blockquote>
<p>æ ‘çŠ¶æ•°ç»„ï¼Œçº¿æ®µæ ‘ï¼Œå­—å…¸æ ‘ï¼Œå¹¶æŸ¥é›†ï¼Œå †....éƒ½æ»¡è¶³<br>
ä½†å¹³è¡¡æ ‘ä¸å¯ï¼Œå¹³è¡¡æ ‘æœ‰å·¦æ—‹å³æ—‹ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„æ‹“æ‰‘åºä¼šå˜</p>
</blockquote>
<h2 id="æ“ä½œ">æ“ä½œ</h2>
<h3 id="æŸ¥è¯¢">æŸ¥è¯¢</h3>
<p>å¯¹äºæ¯æ¬¡æŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦<span style="color: red;">ç¡®å®šç‰ˆæœ¬</span><br>
å¯¹äºæŸä¸ªç‰ˆæœ¬ä¸‹çš„æ ‘ï¼Œåˆ©ç”¨çº¿æ®µæ ‘çš„äºŒåˆ†æ€§è´¨ï¼ŒäºŒåˆ†åœ°å‘ä¸‹æŸ¥è¯¢ï¼ˆå’Œæ™®é€šçš„å·®ä¸å¤šï¼‰</p>
<h3 id="ä¿®æ”¹">ä¿®æ”¹</h3>
<p>æ¯æ¬¡å•ç‚¹ä¿®æ”¹ä¼šæ”¹å˜<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">logn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">n</span></span></span></span>ä¸ªèŠ‚ç‚¹<br>
å› ä¸ºå‘ä¸‹é€’å½’ï¼Œæ‰¾åˆ°è¦ä¿®æ”¹çš„ç‚¹åï¼Œä¸€æ­¥æ­¥å‘ä¸Š<br>
<span style="color: red;">ä»å½“å‰èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹</span>çš„ä¸€æ¡è·¯å¾„ä¸Šéƒ½è¦ä¿®æ”¹</p>
<p>åŒºé—´ä¿®æ”¹å¾ˆéš¾å®ç°ï¼Œæ‡’æ ‡è®°å¯ä»¥é‡‡ç”¨æ°¸ä¹…åŒ–æ‡’æ ‡è®°è¿›è¡Œç»´æŠ¤</p>
<h2 id="ç»å…¸é—®é¢˜åŒºé—´ç¬¬kå°">ç»å…¸é—®é¢˜ï¼šåŒºé—´ç¬¬kå°</h2>
<p><a href="https://www.luogu.com.cn/problem/P3834"><img src="https://i.loli.net/2021/09/23/Hi18j6T7kqRYOhl.png"></a></p>
<h3 id="å‰ç½®çŸ¥è¯†æƒå€¼çº¿æ®µæ ‘">å‰ç½®çŸ¥è¯†ï¼šæƒå€¼çº¿æ®µæ ‘</h3>
<p><b><span style="color: red;">å¯¹å€¼åŸŸå†…æ¯ä¸ªæ•°å‡ºç°çš„æ¬¡æ ‘å»ºç«‹çº¿æ®µæ ‘</span></b></p>
<blockquote>
<p>æ¯”å¦‚è¯´<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mspace width="0.277778em"></mspace><mn>1</mn><mspace width="0.277778em"></mspace><mn>2</mn><mspace width="0.277778em"></mspace><mn>2</mn><mspace width="0.277778em"></mspace><mn>3</mn><mspace width="0.277778em"></mspace><mn>3</mn><mspace width="0.277778em"></mspace><mn>3</mn><mspace width="0.277778em"></mspace><mn>3</mn><mspace width="0.277778em"></mspace><mn>4</mn><mspace width="0.277778em"></mspace><mn>5</mn></mrow><annotation encoding="application/x-tex">1\;1\;2\;2\;3\;3\;3\;3\;4\;5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mspace thickspace"></span><span class="mord mathrm">1</span><span class="mord mspace thickspace"></span><span class="mord mathrm">2</span><span class="mord mspace thickspace"></span><span class="mord mathrm">2</span><span class="mord mspace thickspace"></span><span class="mord mathrm">3</span><span class="mord mspace thickspace"></span><span class="mord mathrm">3</span><span class="mord mspace thickspace"></span><span class="mord mathrm">3</span><span class="mord mspace thickspace"></span><span class="mord mathrm">3</span><span class="mord mspace thickspace"></span><span class="mord mathrm">4</span><span class="mord mspace thickspace"></span><span class="mord mathrm">5</span></span></span></span>è¿™ä¸ªåºåˆ—<br>
ä¼šå½¢æˆè¿™æ ·ä¸€æ£µæƒå€¼çº¿æ®µæ ‘<br>
<img src="https://i.loli.net/2021/09/23/Yo1PiewFNVyns6W.png"><br>
æƒ³è¦æ±‚å¾—æ­¤åºåˆ—ä¸­çš„ç¬¬kå°ï¼Œæ­¤æ—¶åˆ©ç”¨æƒå€¼çº¿æ®µæ ‘çš„æ€§è´¨<br>
æˆ‘ä»¬å¯ä»¥<span style="color: red;">äºŒåˆ†åœ°</span>å¾€ä¸‹èµ°<br>
è‹¥å·¦ä¾§çš„ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‰¥</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\ge k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="base textstyle uncramped"><span class="mrel">â‰¥</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>ï¼Œèµ°å·¦ä¾§<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span><br>
è‹¥å·¦ä¾§çš„ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&lt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">\lt k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mrel">&lt;</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>ï¼Œèµ°å³ä¾§<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>k</mi><mo>âˆ’</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mi>l</mi></msub><mi>e</mi><mi>f</mi><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(k-cnt_left)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">âˆ’</span><span class="mord mathit">c</span><span class="mord mathit">n</span><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span></span><br>
èµ°åˆ°æœ€åå°±æ˜¯ç¬¬<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>å°</p>
</blockquote>
<h3 id="å¿«é€Ÿæ±‚åŒºé—´æƒå€¼çº¿æ®µæ ‘">å¿«é€Ÿæ±‚åŒºé—´æƒå€¼çº¿æ®µæ ‘</h3>
<p>ç”±äºæ˜¯åŒºé—´æŸ¥è¯¢<br>
æ‰€ä»¥å¯ä»¥è”æƒ³åˆ°<span style="color: red;">å‰ç¼€å¤„ç†</span><br>
å³æ„å»ºä¸€æ£µå‰ç¼€çš„æƒå€¼çº¿æ®µæ ‘<br>
é‚£ä¹ˆæˆ‘ä»¬åœ¨<span style="color: red;">è®¿é—®åŒºé—´æƒå€¼çº¿æ®µæ ‘æ—¶ï¼Œå¯ä»¥ä¸¤ä¸ªå‰ç¼€ç›¸å‡å¿«é€Ÿæ±‚å¾—</span><br>
<b>ç›¸å‡æ“ä½œåŒ…æ‹¬è®¿é—®æ“ä½œï¼Œéƒ½å¯ä»¥ç”¨ä¸»å¸­æ ‘å»å®ç°</b><br>
å¯¹äºåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªç¦»æ•£åŒ–ä¹‹åçš„æ•°ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å°†<span style="color: red;">æ’å…¥è§†ä½œå»ºç«‹ä¸€ä¸ªæ–°ç‰ˆæœ¬</span><br>
åœ¨æŸ¥è¯¢åŒºé—´çš„æ—¶å€™åªéœ€è¦<span style="color: red;">æŸ¥è¯¢ä¸¤ä¸ªç‰ˆæœ¬</span>å³å¯</p>
<h3 id="ç¨‹åº">ç¨‹åº</h3>
<pre><code class="language-cpp"><div><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">2e5</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">int</span> a[N];
<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; nums;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
        <span class="hljs-keyword">int</span> l, r, sum;
}sgtr[N * <span class="hljs-number">30</span>];
<span class="hljs-keyword">int</span> tot, root[N];

<span class="hljs-comment">// è®¿é—®xç¦»æ•£åŒ–ä¹‹åçš„å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_Id</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> x )</span> </span>{
        <span class="hljs-keyword">return</span> lower_bound(nums.begin(), nums.end(), x) - nums.begin() + <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// åœ¨è¡¨ç¤º[l, r]åŒºé—´çš„nowèŠ‚ç‚¹æ’å…¥æ•°å­—pï¼Œä¸Šä¸ªç‰ˆæœ¬æ˜¯pre</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Insert</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> pre, <span class="hljs-keyword">int</span> &amp;now, <span class="hljs-keyword">int</span> p )</span> </span>{
        sgtr[++ tot] = sgtr[pre];       <span class="hljs-comment">// å¾ˆå¤šä¿¡æ¯ä¸€æ ·ï¼Œå‰©ä¸‹çš„æ”¹æ”¹å°±è¡Œ</span>
        now = tot;                      <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹ç¼–å· = æ–°åˆ†é…çš„èŠ‚ç‚¹ç¼–å·</span>
        sgtr[now].sum ++;               <span class="hljs-comment">//è¿™ä¸ªèŠ‚ç‚¹æ•°å­—çš„ä¸ªæ•°+1</span>
        <span class="hljs-keyword">if</span> ( l == r ) <span class="hljs-keyword">return</span> ;          <span class="hljs-comment">// å¶å­èŠ‚ç‚¹</span>

        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> ( p &lt;= mid )                 <span class="hljs-comment">// æ’å…¥ä»€ä¹ˆæ•° = åœ¨çº¿æ®µæ ‘å“ªä¸€ä¸ªä½ç½®æ’å…¥</span>
                Insert(l, mid, sgtr[pre].l, sgtr[now].l, p);
        <span class="hljs-keyword">else</span>
                Insert(mid + <span class="hljs-number">1</span>, r, sgtr[pre].r, sgtr[now].r, p);
}

<span class="hljs-comment">// æŸ¥è¯¢ç‰ˆæœ¬R-ç‰ˆæœ¬L-1ï¼Œä¸¤ä¸ªç‰ˆæœ¬åŒæ­¥è¿›è¡Œï¼Œå½“å‰åˆ°è¾¾èŠ‚ç‚¹è¡¨ç¤ºåŒºé—´[l,r]ï¼ŒæŸ¥è¯¢ç¬¬kå¤§</span>
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Query</span> <span class="hljs-params">( <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">int</span> k )</span> </span>{
        <span class="hljs-keyword">if</span> ( l == r ) <span class="hljs-keyword">return</span> l;

        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> cnt = sgtr[sgtr[R].l].sum - sgtr[sgtr[L].l].sum; <span class="hljs-comment">// æ–°å‡å‡ºçš„çº¿æ®µæ ‘çš„å·¦å­æ ‘æœ‰å¤šå°‘ä¸ªæ•°</span>
        <span class="hljs-keyword">if</span> ( k &lt;= cnt )
                <span class="hljs-keyword">return</span> Query(l, mid, sgtr[L].l, sgtr[R].l, k);
        <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">return</span> Query(mid + <span class="hljs-number">1</span>, r, sgtr[L].r, sgtr[R].r, k - cnt);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> ONLINE_JUDGE</span>
        freopen(<span class="hljs-string">&quot;../in.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-built_in">stdin</span>);
        freopen(<span class="hljs-string">&quot;../out.out&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-built_in">stdout</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
        <span class="hljs-keyword">int</span> n, m; <span class="hljs-built_in">cin</span> &gt;&gt; n &gt;&gt; m;
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) {
                <span class="hljs-built_in">cin</span> &gt;&gt; a[i];
                nums.push_back(a[i]);
        }
        sort ( nums.begin(), nums.end() );
        nums.erase(unique(nums.begin(), nums.end()), nums.end());
        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i ++ ) {
                Insert(<span class="hljs-number">1</span>, n, root[i - <span class="hljs-number">1</span>], root[i], get_Id(a[i])); <span class="hljs-comment">// æ’å…¥ï¼ŒåŒæ—¶èµ‹å€¼ç¬¬iä¸ªæ•°å½¢æˆçš„ç‰ˆæœ¬æ˜¯å‡ </span>
        }

        <span class="hljs-keyword">while</span> ( m -- ) {
                <span class="hljs-keyword">int</span> l, r, k; <span class="hljs-built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; k;
                <span class="hljs-built_in">cout</span> &lt;&lt; nums[Query(<span class="hljs-number">1</span>, n, root[l - <span class="hljs-number">1</span>], root[r], k) - <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-built_in">endl</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
    </body>
